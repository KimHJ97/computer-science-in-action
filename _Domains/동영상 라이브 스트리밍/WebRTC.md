# WebRTC (Web Real-Time Communication)

WebRTC(Web Real-Time Communication)는 웹 브라우저나 모바일 애플리케이션 간에 실시간으로 오디오, 비디오, 데이터를 전송할 수 있게 해주는 오픈 소스 기술입니다. 별도의 플러그인이나 추가 설치 없이 브라우저 간 P2P(Peer-to-Peer) 연결을 가능하게 해주는 것이 핵심입니다.

 - `WebRTC 핵심 기능`
    - __실시간 오디오/비디오 통신 (MediaStream)__
        - 마이크와 카메라로부터 오디오/비디오를 캡처하고, 상대 브라우저에 전송
        - getUserMedia() API 사용
    - __P2P 데이터 통신 (DataChannel)__
        - 텍스트나 파일 등 구조화된 데이터를 실시간으로 주고받기 가능
        - 예: 게임, 실시간 채팅, 화이트보드 등
    - __네트워크 처리 (ICE, STUN, TURN)__
        - 방화벽, NAT 우회 등을 위한 다양한 연결 전략
        - P2P 연결을 맺기 위한 시그널링(signaling) 과정은 외부 서버에서 처리
 - `WebRTC 구성 요소`
    - getUserMedia(): 사용자 디바이스에서 오디오/비디오 캡처
    - RTCPeerConnection: 실제 오디오/비디오 스트림을 전달하는 연결 구성
    - RTCDataChannel: 텍스트/파일 등의 데이터 전달
    - STUN 서버: NAT 환경에서 클라이언트의 공인 IP 파악
    - TURN 서버: P2P 연결이 불가능할 때 중계 서버로 사용
    - 시그널링 서버: 초기 연결을 위한 세션 정보 교환 (WebRTC 자체에는 없음)
 - `WebRTC 장단점`
    - __장점__
        - 브라우저 내장 (Chrome, Firefox, Safari, Edge 등 지원)
        - 별도 설치 불필요 (플러그인 없이 동작)
        - 낮은 지연 시간 (P2P 기반)
        - 오픈 소스 (Google이 주도)
    - __단점__
        - P2P 연결이 불가능한 환경에서는 TURN 서버 필요 → 서버 비용 증가
        - 브라우저별 호환성/버전 차이 이슈 존재
        - 시그널링 서버는 별도로 구축해야 함
        - 네트워크 환경에 따라 품질이 다름
 - `WebRTC 사용 예시`
    - 화상 회의, 구글 Meet, Discord, Zoom(일부)
    - 웹 기반 영상 통화 서비스
    - 실시간 협업 툴 (공유 화이트보드, 코딩 협업)
    - 실시간 게임 데이터 동기화
    - 실시간 원격 제어/상담

## 1. P2P 기반

P2P(Peer-to-Peer)란 중앙 서버 없이 참여자끼리 직접 연결하여 데이터를 주고받는 구조입니다.

 - A와 B가 영상 통화를 한다면, A의 브라우저 → B의 브라우저로 직접 미디어를 전송하는 구조.
 - 서버는 초기 연결 정보를 주고받는 "시그널링(Signaling)" 용도로만 사용됨.
```sql
A <──── Direct Media Stream ────> B
        (No Media Server In Between)
```
<br/>

 - __P2P 기반 장점__
    - 낮은 지연: 서버를 거치지 않기 때문에 전송 지연(latency)이 최소화됨 (수백 ms 수준)
    - 서버 비용 절감: 실시간 미디어 데이터가 서버를 통과하지 않음 → 서버 트래픽/비용 ↓
    - 개인 간 직접 통신: 일부 개인정보 보호 측면에서 장점 있음
 - __P2P 기반 단점__
    - 확장성 부족
        - P2P는 기본적으로 1:1 통신에 적합함.
        - N명이 통신하려면 각 참여자가 N-1명과 직접 연결해야 함 → 복잡도 급증.
        - 참가자 수 증가 시 CPU, RAM, 네트워크 부담 기하급수적으로 증가
        - 참여자수 N명일 때, 연결 수 N * (N - 1) / 2
    - NAT/방화벽 문제
        - 대부분의 가정/회사 네트워크는 NAT(Network Address Translation)이나 방화벽으로 보호됨.
        - 직접 연결이 불가능한 경우 STUN/TURN 서버를 통해야 함
        - TURN 서버는 미디어 데이터를 중계 → 사실상 서버 기반이 됨 → 성능과 비용 이슈
    - 모바일 환경 취약
        - 모바일 기기는 네트워크 변화(와이파이 ↔ LTE 등)에 민감하고, 배터리/연산 자원 제한
        - 브라우저 간 다중 연결은 모바일에서 특히 부담됨
    - 대역폭 부담
        - 각 사용자마다 모든 참여자에게 각각 영상을 전송해야 하므로 업로드 대역폭이 한계에 부딪힘
        - 예시: 1명이 720p 영상을 4명에게 전송하려면 동시에 4스트림 송출

### 1-1. SFU(Selective Forwarding Unit) 방식

WebRTC는 SFU를 활용하면 P2P 기반의 장점을 유지하면서도 확장 가능

 - 각 참가자가 SFU 서버에 한 번만 영상 전송
 - SFU는 받은 스트림을 구독자에게 선택적으로 전달
 - 참가자는 1개의 업로드만 하고, 수신은 여러 개 가능
```css
[A]───▶ SFU ───▶ [B]
              └──▶ [C]
              └──▶ [D]
```

 - 송신자는 1개의 스트림만 SFU에 업로드
 - SFU는 각 수신자에게 그대로 복사해서 전달
 - 대역폭은 절약되고, 지연 시간은 WebRTC 수준(수백 ms)
```less
  [송신자]
     │
     ▼
    [SFU]
   / |  \
 [A][B]...[N명 수신자에게 전달]
```

 - `SFU 한계`
    - SFU는 수십~수백 명 규모의 인터랙티브 방송에는 적합하지만, 유튜브처럼 수만 명 이상의 "단방향 대규모 스트리밍"에는 비효율적이다.
    - SFU는 소규모~중규모 "실시간 양방향" 방송에 적합 유튜브처럼 수만 명 대상 "대규모 단방향" 방송은 CDN + HLS 구조가 정답
    - 수신자 수: SFU는 각 사용자에게 개별 스트림을 전달해야 하므로, 수천 ~ 수만 명에게 전달하려면 막대한 서버 대역폭과 리소스가 필요
    - 서버 부하: 각 시청자마다 개별 연결(Session, ICE, RTP 등)이 발생함 → 메모리/연결 수 부담
    - 로드 밸런싱 어려움: WebRTC는 HTTP 기반이 아니라 CDN처럼 전통적인 캐싱이나 전송 최적화가 힘듦
    - 브라우저 자원 문제: 클라이언트마다 WebRTC 처리를 해야 하기 때문에 모바일/저사양 기기에서 한계 발생


| 항목          | SFU(WebRTC 기반)            | 유튜브(HLS/RTMP/CDN)         |
| ----------- | ------------------------- | ------------------------- |
| **지연 시간**   | 0.3\~1초 (초저지연)            | 5\~30초 (버퍼 포함)            |
| **참가자 수**   | 실시간 통신 수십\~수백 명 적합        | 수천\~수백만 명 가능              |
| **대역폭 최적화** | 미약 (서버가 직접 분배)            | 매우 우수 (CDN 캐싱 활용)         |
| **인터랙션**    | 양방향 (채팅/질문 등 가능)          | 제한적 (채팅 정도)               |
| **구현 복잡도**  | 높음 (STUN/TURN, WebRTC 처리) | 비교적 단순 (HLS 세그먼트 HTTP 전송) |


## 라이브 스트리밍 한계

 - `요약`
    - WebRTC는 양방향, 초저지연, 소규모 통신에 적합하고, 유튜브 라이브처럼 대규모, 고품질, 단방향 방송에는 HLS/RTMP가 훨씬 유리합니다.
